name: Nightly Job

on:
  schedule:
    - cron: '0 0 * * *' # This will run every night at midnight UTC
#    - cron: '*/10 * * * *' # testing schedule

jobs:
  nightly-job:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: 3.11
      - name: Install poetry
        run: pip install poetry
      - name: Install dependencies
        run: |
          cd aws-news-crawler
          poetry install
      - name: Execute crawler
        run: |
          cd aws-news-crawler
          poetry run python aws_news_crawler/__init__.py
      - name: push to git
        run: |
          git config user.name "Roman Tsypuk"
          git config user.email tsypuk.conf@gmail.com
          git add .
          DATE=$(date +'%Y-%m-%d')
          git commit -m "chore(rss): updated AWS news - $DATE"
          git push
